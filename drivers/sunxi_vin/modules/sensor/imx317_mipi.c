/*
 * A V4L2 driver for imx317 Raw cameras.
 *
 * Copyright (c) 2017 by Allwinnertech Co., Ltd.  http://www.allwinnertech.com
 *
 * Authors:  Zhao Wei <zhaowei@allwinnertech.com>
 *    Liang WeiJie <liangweijie@allwinnertech.com>
 *
 * This program is free software; you can redistribute it and/or modify
 * it under the terms of the GNU General Public License version 2 as
 * published by the Free Software Foundation.
 */

#include "camera.h"

#define MCLK              (24*1000*1000)
#define V4L2_IDENT_SENSOR 0x0317

/*
 * Our nominal (default) frame rate.
 */

#define SENSOR_FRAME_RATE 30

/*
 * The IMX317 i2c address
 */
#define I2C_ADDR 0x34

#define SENSOR_NUM 0x2
#define SENSOR_NAME "imx317_mipi"
#define SENSOR_NAME_2 "imx317_mipi_2"


/*
 * The default register settings
 */

static struct regval_list sensor_default_regs[] = {

};
#if 0
static struct regval_list sensor_12b4k15_regs[] = {
	{0x3001, 0x10},
	{0xffff, 0x10},
	{0x3000, 0x12},

	{0x303E, 0x03},
	{0x3120, 0xC0},
	{0x3121, 0x00},
	{0x3122, 0x02},
	{0x3123, 0x01},
	{0x3129, 0x9C},
	{0x312A, 0x02},
	{0x312D, 0x02},
	{0x3AC4, 0x01},
	{0x310B, 0x00},
	{0x30EE, 0x01},
	{0x3304, 0x32},
	{0x3305, 0x00},
	{0x3306, 0x32},
	{0x3307, 0x00},
	{0x3590, 0x32},
	{0x3591, 0x00},
	{0x3686, 0x32},
	{0x3687, 0x00},
	{0x3045, 0x32},
	{0x301A, 0x00},
	{0x304C, 0x00},
	{0x304D, 0x03},
	{0x331C, 0x1A},
	{0x331D, 0x00},
	{0x3502, 0x02},
	{0x3529, 0x0E},
	{0x352A, 0x0E},
	{0x352B, 0x0E},
	{0x3538, 0x0E},
	{0x3539, 0x0E},
	{0x3553, 0x00},
	{0x357D, 0x05},
	{0x357F, 0x05},
	{0x3581, 0x04},
	{0x3583, 0x76},
	{0x3587, 0x01},
	{0x35BB, 0x0E},
	{0x35BC, 0x0E},
	{0x35BD, 0x0E},
	{0x35BE, 0x0E},
	{0x35BF, 0x0E},
	{0x366E, 0x00},
	{0x366F, 0x00},
	{0x3670, 0x00},
	{0x3671, 0x00},
	{0x3004, 0x00},
	{0x3005, 0x07},
	{0x3006, 0x00},
	{0x3007, 0x02},
	{0x300E, 0x00},
	{0x300F, 0x00},
	{0x3037, 0x00},
	{0x3038, 0x00},
	{0x3039, 0x00},
	{0x303A, 0x00},
	{0x303B, 0x00},
	{0x30DD, 0x00},
	{0x30DE, 0x00},
	{0x30DF, 0x00},
	{0x30E0, 0x00},
	{0x30E1, 0x00},
	{0x30E2, 0x01},
	{0x30F6, 0x20},
	{0x30F7, 0x03},
	{0x30F8, 0x76},
	{0x30F9, 0x17},
	{0x30FA, 0x00},
	{0x3130, 0xAA},
	{0x3131, 0x08},
	{0x3132, 0x9A},
	{0x3133, 0x08},
	{0x3A54, 0x18},
	{0x3A55, 0x0F},
	{0x3342, 0xFF},
	{0x3343, 0x01},
	{0x3344, 0xFF},
	{0x3345, 0x01},
	{0x3528, 0x0F},
	{0x3554, 0x00},
	{0x3555, 0x00},
	{0x3556, 0x00},
	{0x3557, 0x00},
	{0x3558, 0x00},
	{0x3559, 0x1F},
	{0x355A, 0x1F},
	{0x35BA, 0x0F},
	{0x366A, 0x00},
	{0x366B, 0x00},
	{0x366C, 0x00},
	{0x366D, 0x00},
	{0x33A6, 0x01},
	{0x306B, 0x07},
	{0x3A41, 0x10},
	{0x3019, 0x10},

	{0x302E, 0x04},
	{0x302F, 0x00},
	{0x3030, 0x05},
	{0x3031, 0x43},
	{0x3032, 0x00},
	{0x3033, 0x08},
	{0x3041, 0x30},
	{0x3042, 0x01},
	{0x3043, 0x08},
	{0x30E9, 0x00},

	{0x3134, 0x5f},
	{0x3135, 0x00},
	{0x3136, 0x47},
	{0x3137, 0x00},
	{0x3138, 0x00},
	{0x3139, 0x00},
	{0x313A, 0x27},
	{0x313B, 0x00},
	{0x313C, 0x27},
	{0x313D, 0x00},
	{0x313E, 0x97},
	{0x313F, 0x00},
	{0x3140, 0x00},
	{0x3141, 0x00},
	{0x3142, 0x1F},
	{0x3143, 0x00},
	{0x3144, 0x0F},
	{0x3145, 0x00},
	{0x3A85, 0x03},
	{0x3A86, 0x47},
	{0x3A87, 0x00},

	{0xffff, 0x10},

	{0x3000, 0x00},

	{0x303E, 0x03},

	{0xffff, 0x10},

	{0x30F4, 0x00},
	{0x3018, 0x02},
	{0x300C, 0x0C},
	{0x300D, 0x00},

	{0x300A, 0xA5},
	{0x300B, 0x07},
};

static struct regval_list sensor_12b4k30_regs[] = {
	{0x3001, 0x10},
	{0xffff, 0x10},
	{0x3000, 0x12},

	{0x303E, 0x03},
	{0x3120, 0xC0},
	{0x3121, 0x00},
	{0x3122, 0x02},
	{0x3123, 0x00},
	{0x3129, 0x9C},
	{0x312A, 0x02},
	{0x312D, 0x02},
	{0x3AC4, 0x00},
	{0x310B, 0x00},
	{0x30EE, 0x01},
	{0x3304, 0x32},
	{0x3305, 0x00},
	{0x3306, 0x32},
	{0x3307, 0x00},
	{0x3590, 0x32},
	{0x3591, 0x00},
	{0x3686, 0x32},
	{0x3687, 0x00},
	{0x3045, 0x32},
	{0x301A, 0x00},
	{0x304C, 0x00},
	{0x304D, 0x03},
	{0x331C, 0x1A},
	{0x331D, 0x00},
	{0x3502, 0x02},
	{0x3529, 0x0E},
	{0x352A, 0x0E},
	{0x352B, 0x0E},
	{0x3538, 0x0E},
	{0x3539, 0x0E},
	{0x3553, 0x00},
	{0x357D, 0x05},
	{0x357F, 0x05},
	{0x3581, 0x04},
	{0x3583, 0x76},
	{0x3587, 0x01},
	{0x35BB, 0x0E},
	{0x35BC, 0x0E},
	{0x35BD, 0x0E},
	{0x35BE, 0x0E},
	{0x35BF, 0x0E},
	{0x366E, 0x00},
	{0x366F, 0x00},
	{0x3670, 0x00},
	{0x3671, 0x00},
	{0x3004, 0x00},
	{0x3005, 0x07},
	{0x3006, 0x00},
	{0x3007, 0x02},
	{0x300E, 0x00},
	{0x300F, 0x00},
	{0x3037, 0x00},
	{0x3038, 0x00},
	{0x3039, 0x00},
	{0x303A, 0x00},
	{0x303B, 0x00},
	{0x30DD, 0x00},
	{0x30DE, 0x00},
	{0x30DF, 0x00},
	{0x30E0, 0x00},
	{0x30E1, 0x00},
	{0x30E2, 0x01},
	{0x30F6, 0x08},
	{0x30F7, 0x02},
	{0x30F8, 0x0C},
	{0x30F9, 0x12},
	{0x30FA, 0x00},
	{0x3130, 0xAA},
	{0x3131, 0x08},
	{0x3132, 0x9A},
	{0x3133, 0x08},
	{0x3A54, 0x18},
	{0x3A55, 0x0F},
	{0x3342, 0xFF},
	{0x3343, 0x01},
	{0x3344, 0xFF},
	{0x3345, 0x01},
	{0x3528, 0x0F},
	{0x3554, 0x00},
	{0x3555, 0x00},
	{0x3556, 0x00},
	{0x3557, 0x00},
	{0x3558, 0x00},
	{0x3559, 0x1F},
	{0x355A, 0x1F},
	{0x35BA, 0x0F},
	{0x366A, 0x00},
	{0x366B, 0x00},
	{0x366C, 0x00},
	{0x366D, 0x00},
	{0x33A6, 0x01},
	{0x306B, 0x07},
	{0x3A41, 0x10},
	{0x3019, 0x10},


	{0x302E, 0x04},
	{0x302F, 0x00},
	{0x3030, 0x05},
	{0x3031, 0x43},
	{0x3032, 0x00},
	{0x3033, 0x08},
	{0x3041, 0x30},
	{0x3042, 0x01},
	{0x3043, 0x08},
	{0x30E9, 0x00},

	{0x3134, 0x8f},
	{0x3135, 0x00},
	{0x3136, 0x87},
	{0x3137, 0x00},
	{0x3138, 0x00},
	{0x3139, 0x00},
	{0x313A, 0x4f},
	{0x313B, 0x00},
	{0x313C, 0x6f},
	{0x313D, 0x00},
	{0x313E, 0x3F},
	{0x313F, 0x01},
	{0x3140, 0x00},
	{0x3141, 0x00},
	{0x3142, 0x47},
	{0x3143, 0x00},
	{0x3144, 0x0F},
	{0x3145, 0x00},
	{0x3A85, 0x03},
	{0x3A86, 0x47},
	{0x3A87, 0x00},

	{0xffff, 0x10},

	{0x3000, 0x00},

	{0x303E, 0x03},

	{0xffff, 0x10},

	{0x30F4, 0x00},
	{0x3018, 0x02},
	{0x300C, 0x0C},
	{0x300D, 0x00},

	{0x300A, 0xA5},
	{0x300B, 0x07},
};

static struct regval_list sensor_10b4k50_regs[] = {
	{0x3001, 0x10},
	{0xffff, 0x10},
	{0x3000, 0x12},

	{0x303E, 0x03},
	{0x3120, 0xC0},
	{0x3121, 0x00},
	{0x3122, 0x02},
	{0x3123, 0x00},
	{0x3129, 0x9C},
	{0x312A, 0x02},
	{0x312D, 0x02},
	{0x3AC4, 0x00},
	{0x310B, 0x00},
	{0x30EE, 0x01},
	{0x3304, 0x32},
	{0x3305, 0x00},
	{0x3306, 0x32},
	{0x3307, 0x00},
	{0x3590, 0x32},
	{0x3591, 0x00},
	{0x3686, 0x32},
	{0x3687, 0x00},
	{0x3045, 0x32},
	{0x301A, 0x00},
	{0x304C, 0x00},
	{0x304D, 0x03},
	{0x331C, 0x1A},
	{0x331D, 0x00},
	{0x3502, 0x02},
	{0x3529, 0x0E},
	{0x352A, 0x0E},
	{0x352B, 0x0E},
	{0x3538, 0x0E},
	{0x3539, 0x0E},
	{0x3553, 0x00},
	{0x357D, 0x05},
	{0x357F, 0x05},
	{0x3581, 0x04},
	{0x3583, 0x76},
	{0x3587, 0x01},
	{0x35BB, 0x0E},
	{0x35BC, 0x0E},
	{0x35BD, 0x0E},
	{0x35BE, 0x0E},
	{0x35BF, 0x0E},
	{0x366E, 0x00},
	{0x366F, 0x00},
	{0x3670, 0x00},
	{0x3671, 0x00},
	{0x3004, 0x01},
	{0x3005, 0x01},
	{0x3006, 0x00},
	{0x3007, 0x02},
	{0x300E, 0x00},
	{0x300F, 0x00},
	{0x3037, 0x00},
	{0x3038, 0x00},
	{0x3039, 0x00},
	{0x303A, 0x00},
	{0x303B, 0x00},
	{0x30DD, 0x00},
	{0x30DE, 0x00},
	{0x30DF, 0x00},
	{0x30E0, 0x00},
	{0x30E1, 0x00},
	{0x30E2, 0x01},
	{0x30F6, 0x4a},
	{0x30F7, 0x01},
	{0x30F8, 0x70},
	{0x30F9, 0x1c},
	{0x30FA, 0x00},
	{0x3130, 0x86},
	{0x3131, 0x08},
	{0x3132, 0x7E},
	{0x3133, 0x08},
	{0x3A54, 0x18},
	{0x3A55, 0x0F},
	{0x3342, 0x0A},
	{0x3343, 0x00},
	{0x3344, 0x16},
	{0x3345, 0x00},
	{0x3528, 0x0E},
	{0x3554, 0x1F},
	{0x3555, 0x01},
	{0x3556, 0x01},
	{0x3557, 0x01},
	{0x3558, 0x01},
	{0x3559, 0x00},
	{0x355A, 0x00},
	{0x35BA, 0x0E},
	{0x366A, 0x1B},
	{0x366B, 0x1A},
	{0x366C, 0x19},
	{0x366D, 0x17},
	{0x33A6, 0x00},
	{0x306B, 0x05},
	{0x3A41, 0x08},
	{0x3019, 0x10},


	{0x302E, 0x04},
	{0x302F, 0x00},
	{0x3030, 0x05},
	{0x3031, 0x43},
	{0x3032, 0x00},
	{0x3033, 0x08},
	{0x3041, 0x30},
	{0x3042, 0x01},
	{0x3043, 0x08},
	{0x30E9, 0x00},

	{0x3134, 0x8f},
	{0x3135, 0x00},
	{0x3136, 0x87},
	{0x3137, 0x00},
	{0x3138, 0x00},
	{0x3139, 0x00},
	{0x313A, 0x4f},
	{0x313B, 0x00},
	{0x313C, 0x6f},
	{0x313D, 0x00},
	{0x313E, 0x3F},
	{0x313F, 0x01},
	{0x3140, 0x00},
	{0x3141, 0x00},
	{0x3142, 0x47},
	{0x3143, 0x00},
	{0x3144, 0x0F},
	{0x3145, 0x00},
	{0x3A85, 0x03},
	{0x3A86, 0x47},
	{0x3A87, 0x00},

	{0xffff, 0x10},

	{0x3000, 0x00},

	{0x303E, 0x03},

	{0xffff, 0x10},

	{0x30F4, 0x00},
	{0x3018, 0x02},
	{0x300C, 0x0C},
	{0x300D, 0x00},

	{0x300A, 0xA5},
	{0x300B, 0x07},
};

static struct regval_list sensor_10b4k60_regs[] = {
	{0x3000, 0x12},

	{0x303E, 0x02},
	{0x3120, 0xF0},
	{0x3121, 0x00},
	{0x3122, 0x02},
	{0x3123, 0x00},
	{0x3129, 0x9C},
	{0x312A, 0x02},
	{0x312D, 0x02},
	{0x3AC4, 0x00},
	{0x310B, 0x00},
	{0x30EE, 0x01},
	{0x3304, 0x32},
	{0x3305, 0x00},
	{0x3306, 0x32},
	{0x3307, 0x00},
	{0x3590, 0x32},
	{0x3591, 0x00},
	{0x3686, 0x32},
	{0x3687, 0x00},
	{0x3045, 0x32},
	{0x301A, 0x00},
	{0x304C, 0x00},
	{0x304D, 0x03},
	{0x331C, 0x1A},
	{0x331D, 0x00},
	{0x3502, 0x02},
	{0x3529, 0x0E},
	{0x352A, 0x0E},
	{0x352B, 0x0E},
	{0x3538, 0x0E},
	{0x3539, 0x0E},
	{0x3553, 0x00},
	{0x357D, 0x05},
	{0x357F, 0x05},
	{0x3581, 0x04},
	{0x3583, 0x76},
	{0x3587, 0x01},
	{0x35BB, 0x0E},
	{0x35BC, 0x0E},
	{0x35BD, 0x0E},
	{0x35BE, 0x0E},
	{0x35BF, 0x0E},
	{0x366E, 0x00},
	{0x366F, 0x00},
	{0x3670, 0x00},
	{0x3671, 0x00},
	{0x3004, 0x01},
	{0x3005, 0x01},
	{0x3006, 0x00},
	{0x3007, 0x02},
	{0x300E, 0x00},
	{0x300F, 0x00},
	{0x3037, 0x00},
	{0x3038, 0x00},
	{0x3039, 0x00},
	{0x303A, 0x00},
	{0x303B, 0x00},
	{0x30DD, 0x00},
	{0x30DE, 0x00},
	{0x30DF, 0x00},
	{0x30E0, 0x00},
	{0x30E1, 0x00},
	{0x30E2, 0x01},
	{0x30F6, 0x07},
	{0x30F7, 0x01},
	{0x30F8, 0xC6},
	{0x30F9, 0x11},
	{0x30FA, 0x00},
	{0x3130, 0x86},
	{0x3131, 0x08},
	{0x3132, 0x7E},
	{0x3133, 0x08},
	{0x3A54, 0x18},
	{0x3A55, 0x0F},
	{0x3342, 0x0A},
	{0x3343, 0x00},
	{0x3344, 0x16},
	{0x3345, 0x00},
	{0x3528, 0x0E},
	{0x3554, 0x1F},
	{0x3555, 0x01},
	{0x3556, 0x01},
	{0x3557, 0x01},
	{0x3558, 0x01},
	{0x3559, 0x00},
	{0x355A, 0x00},
	{0x35BA, 0x0E},
	{0x366A, 0x1B},
	{0x366B, 0x1A},
	{0x366C, 0x19},
	{0x366D, 0x17},
	{0x33A6, 0x01},
	{0x306B, 0x05},
	{0x3A41, 0x08},
	{0x3019, 0x10},


	{0x302E, 0x04},
	{0x302F, 0x00},
	{0x3030, 0x43},
	{0x3031, 0x05},
	{0x3032, 0x08},
	{0x3033, 0x00},
	{0x3041, 0x30},
	{0x3042, 0x08},
	{0x3043, 0x01},
	{0x30E9, 0x00},

	{0x3134, 0xA7},
	{0x3135, 0x00},
	{0x3136, 0x9F},
	{0x3137, 0x00},
	{0x3138, 0x00},
	{0x3139, 0x00},
	{0x313A, 0x5F},
	{0x313B, 0x00},
	{0x313C, 0x5F},
	{0x313D, 0x00},
	{0x313E, 0x7F},
	{0x313F, 0x01},
	{0x3140, 0x00},
	{0x3141, 0x00},
	{0x3142, 0x4F},
	{0x3143, 0x00},
	{0x3144, 0x0F},
	{0x3145, 0x00},
	{0x3A85, 0x03},
	{0x3A86, 0x47},
	{0x3A87, 0x00},

	{REG_DLY, 0x10},

	{0x3000, 0x00},

	{0x303E, 0x02},

	{REG_DLY, 0x10},

	{0x30F4, 0x00},
	{0x3018, 0x02},
	{0x300C, 0x0C},
	{0x300D, 0x00},
};

static struct regval_list sensor_12b4k25_regs[] = {
	{0x3000, 0x12},

	{0x303E, 0x02},
	{0x3120, 0xF0},
	{0x3121, 0x00},
	{0x3122, 0x02},
	{0x3123, 0x01},
	{0x3129, 0x9C},
	{0x312A, 0x02},
	{0x312D, 0x02},
	{0x3AC4, 0x01},
	{0x310B, 0x00},
	{0x30EE, 0x01},
	{0x3304, 0x32},
	{0x3305, 0x00},
	{0x3306, 0x32},
	{0x3307, 0x00},
	{0x3590, 0x32},
	{0x3591, 0x00},
	{0x3686, 0x32},
	{0x3687, 0x00},
	{0x3045, 0x32},
	{0x301A, 0x00},
	{0x304C, 0x00},
	{0x304D, 0x03},
	{0x331C, 0x1A},
	{0x331D, 0x00},
	{0x3502, 0x02},
	{0x3529, 0x0E},
	{0x352A, 0x0E},
	{0x352B, 0x0E},
	{0x3538, 0x0E},
	{0x3539, 0x0E},
	{0x3553, 0x00},
	{0x357D, 0x05},
	{0x357F, 0x05},
	{0x3581, 0x04},
	{0x3583, 0x76},
	{0x3587, 0x01},
	{0x35BB, 0x0E},
	{0x35BC, 0x0E},
	{0x35BD, 0x0E},
	{0x35BE, 0x0E},
	{0x35BF, 0x0E},
	{0x366E, 0x00},
	{0x366F, 0x00},
	{0x3670, 0x00},
	{0x3671, 0x00},
	{0x3004, 0x00},
	{0x3005, 0x07},
	{0x3006, 0x00},
	{0x3007, 0x02},
	{0x300E, 0x00},
	{0x300F, 0x00},
	{0x3037, 0x00},
	{0x3038, 0x00},
	{0x3039, 0x00},
	{0x303A, 0x00},
	{0x303B, 0x00},
	{0x30DD, 0x00},
	{0x30DE, 0x00},
	{0x30DF, 0x00},
	{0x30E0, 0x00},
	{0x30E1, 0x00},
	{0x30E2, 0x00},
	{0x30F6, 0x80},
	{0x30F7, 0x02},
	{0x30F8, 0x94},
	{0x30F9, 0x11},
	{0x30FA, 0x00},
	{0x3130, 0xAA},
	{0x3131, 0x08},
	{0x3132, 0x9A},
	{0x3133, 0x08},
	{0x3A54, 0x18},
	{0x3A55, 0x0F},
	{0x3342, 0xFF},
	{0x3343, 0x01},
	{0x3344, 0xFF},
	{0x3345, 0x01},
	{0x3528, 0x0F},
	{0x3554, 0x00},
	{0x3555, 0x00},
	{0x3556, 0x00},
	{0x3557, 0x00},
	{0x3558, 0x00},
	{0x3559, 0x1F},
	{0x355A, 0x1F},
	{0x35BA, 0x0F},
	{0x366A, 0x00},
	{0x366B, 0x00},
	{0x366C, 0x00},
	{0x366D, 0x00},
	{0x33A6, 0x01},
	{0x306B, 0x07},
	{0x3A41, 0x10},
	{0x3019, 0x10},


	{0x302E, 0x04},
	{0x302F, 0x00},
	{0x3030, 0x43},
	{0x3031, 0x05},
	{0x3032, 0x08},
	{0x3033, 0x00},
	{0x3041, 0x30},
	{0x3042, 0x08},
	{0x3043, 0x01},
	{0x30E9, 0x00},

	{0x3134, 0x77},
	{0x3135, 0x00},
	{0x3136, 0x67},
	{0x3137, 0x00},
	{0x3138, 0x00},
	{0x3139, 0x00},
	{0x313A, 0x37},
	{0x313B, 0x00},
	{0x313C, 0x37},
	{0x313D, 0x00},
	{0x313E, 0xDF},
	{0x313F, 0x00},
	{0x3140, 0x00},
	{0x3141, 0x00},
	{0x3142, 0x2F},
	{0x3143, 0x00},
	{0x3144, 0x0F},
	{0x3145, 0x00},
	{0x3A85, 0x03},
	{0x3A86, 0x47},
	{0x3A87, 0x00},

	{REG_DLY, 0x10},

	{0x3000, 0x00},

	{0x303E, 0x02},

	{REG_DLY, 0x10},

	{0x30F4, 0x00},
	{0x3018, 0x02},
	{0x300C, 0x0C},
	{0x300D, 0x00},

};

static struct regval_list sensor_10b4k30_regs[] = {

	{0x3000, 0x12},

	{0x303E, 0x02},
	{0x3120, 0xF0},
	{0x3121, 0x00},
	{0x3122, 0x02},
	{0x3123, 0x01},
	{0x3129, 0x9C},
	{0x312A, 0x02},
	{0x312D, 0x02},
	{0x3AC4, 0x01},
	{0x310B, 0x00},
	{0x30EE, 0x01},
	{0x3304, 0x32},
	{0x3305, 0x00},
	{0x3306, 0x32},
	{0x3307, 0x00},
	{0x3590, 0x32},
	{0x3591, 0x00},
	{0x3686, 0x32},
	{0x3687, 0x00},
	{0x3045, 0x32},
	{0x301A, 0x00},
	{0x304C, 0x00},
	{0x304D, 0x03},
	{0x331C, 0x1A},
	{0x331D, 0x00},
	{0x3502, 0x02},
	{0x3529, 0x0E},
	{0x352A, 0x0E},
	{0x352B, 0x0E},
	{0x3538, 0x0E},
	{0x3539, 0x0E},
	{0x3553, 0x00},
	{0x357D, 0x05},
	{0x357F, 0x05},
	{0x3581, 0x04},
	{0x3583, 0x76},
	{0x3587, 0x01},
	{0x35BB, 0x0E},
	{0x35BC, 0x0E},
	{0x35BD, 0x0E},
	{0x35BE, 0x0E},
	{0x35BF, 0x0E},
	{0x366E, 0x00},
	{0x366F, 0x00},
	{0x3670, 0x00},
	{0x3671, 0x00},
	{0x3004, 0x01},
	{0x3005, 0x01},
	{0x3006, 0x00},
	{0x3007, 0x02},
	{0x300E, 0x00},
	{0x300F, 0x00},
	{0x3037, 0x00},
	{0x3038, 0x00},
	{0x3039, 0x00},
	{0x303A, 0x00},
	{0x303B, 0x00},
	{0x30DD, 0x00},
	{0x30DE, 0x00},
	{0x30DF, 0x00},
	{0x30E0, 0x00},
	{0x30E1, 0x00},
	{0x30E2, 0x01},
	{0x30F6, 0x10},
	{0x30F7, 0x02},
	{0x30F8, 0xC6},
	{0x30F9, 0x11},
	{0x30FA, 0x00},
	{0x3130, 0x86},
	{0x3131, 0x08},
	{0x3132, 0x7E},
	{0x3133, 0x08},
	{0x3A54, 0x18},
	{0x3A55, 0x0F},
	{0x3342, 0x0A},
	{0x3343, 0x00},
	{0x3344, 0x16},
	{0x3345, 0x00},
	{0x3528, 0x0E},
	{0x3554, 0x1F},
	{0x3555, 0x01},
	{0x3556, 0x01},
	{0x3557, 0x01},
	{0x3558, 0x01},
	{0x3559, 0x00},
	{0x355A, 0x00},
	{0x35BA, 0x0E},
	{0x366A, 0x1B},
	{0x366B, 0x1A},
	{0x366C, 0x19},
	{0x366D, 0x17},
	{0x33A6, 0x01},
	{0x306B, 0x05},
	{0x3A41, 0x08},
	{0x3019, 0x10},

	{0x302E, 0x04},
	{0x302F, 0x00},
	{0x3030, 0x43},
	{0x3031, 0x05},
	{0x3032, 0x08},
	{0x3033, 0x00},
	{0x3041, 0x30},
	{0x3042, 0x08},
	{0x3043, 0x01},
	{0x30E9, 0x00},

	{0x3134, 0x77},
	{0x3135, 0x00},
	{0x3136, 0x67},
	{0x3137, 0x00},
	{0x3138, 0x00},
	{0x3139, 0x00},
	{0x313A, 0x37},
	{0x313B, 0x00},
	{0x313C, 0x57},
	{0x313D, 0x00},
	{0x313E, 0xDF},
	{0x313F, 0x00},
	{0x3140, 0x00},
	{0x3141, 0x00},
	{0x3142, 0x2F},
	{0x3143, 0x00},
	{0x3144, 0x0F},
	{0x3145, 0x00},
	{0x3A85, 0x03},
	{0x3A86, 0x47},
	{0x3A87, 0x00},

	{REG_DLY, 0x10},

	{0x3000, 0x00},

	{0x303E, 0x02},

	{REG_DLY, 0x10},

	{0x30F4, 0x00},
	{0x3018, 0x02},
	{0x300C, 0x0C},
	{0x300D, 0x00},

	{0x300A, 0xA5},
	{0x300B, 0x07},
	{0x3012, 0x03},

};

static struct regval_list sensor_10b4k25_regs[] = {

	{0x3000, 0x12},

	{0x303E, 0x02},
	{0x3120, 0xC8},
	{0x3121, 0x00},
	{0x3122, 0x02},
	{0x3123, 0x01},
	{0x3129, 0x9C},
	{0x312A, 0x02},
	{0x312D, 0x02},
	{0x3AC4, 0x01},
	{0x310B, 0x00},
	{0x30EE, 0x01},
	{0x3304, 0x32},
	{0x3305, 0x00},
	{0x3306, 0x32},
	{0x3307, 0x00},
	{0x3590, 0x32},
	{0x3591, 0x00},
	{0x3686, 0x32},
	{0x3687, 0x00},
	{0x3045, 0x32},
	{0x301A, 0x00},
	{0x304C, 0x00},
	{0x304D, 0x03},
	{0x331C, 0x1A},
	{0x331D, 0x00},
	{0x3502, 0x02},
	{0x3529, 0x0E},
	{0x352A, 0x0E},
	{0x352B, 0x0E},
	{0x3538, 0x0E},
	{0x3539, 0x0E},
	{0x3553, 0x00},
	{0x357D, 0x05},
	{0x357F, 0x05},
	{0x3581, 0x04},
	{0x3583, 0x76},
	{0x3587, 0x01},
	{0x35BB, 0x0E},
	{0x35BC, 0x0E},
	{0x35BD, 0x0E},
	{0x35BE, 0x0E},
	{0x35BF, 0x0E},
	{0x366E, 0x00},
	{0x366F, 0x00},
	{0x3670, 0x00},
	{0x3671, 0x00},
	{0x3004, 0x01},
	{0x3005, 0x01},
	{0x3006, 0x00},
	{0x3007, 0x02},
	{0x300E, 0x00},
	{0x300F, 0x00},
	{0x3037, 0x00},
	{0x3038, 0x00},
	{0x3039, 0x00},
	{0x303A, 0x00},
	{0x303B, 0x00},
	{0x30DD, 0x00},
	{0x30DE, 0x00},
	{0x30DF, 0x00},
	{0x30E0, 0x00},
	{0x30E1, 0x00},
	{0x30E2, 0x01},
	{0x30F6, 0x10},
	{0x30F7, 0x02},
	{0x30F8, 0xC6},
	{0x30F9, 0x11},
	{0x30FA, 0x00},
	{0x3130, 0x86},
	{0x3131, 0x08},
	{0x3132, 0x7E},
	{0x3133, 0x08},
	{0x3A54, 0x18},
	{0x3A55, 0x0F},
	{0x3342, 0x0A},
	{0x3343, 0x00},
	{0x3344, 0x16},
	{0x3345, 0x00},
	{0x3528, 0x0E},
	{0x3554, 0x1F},
	{0x3555, 0x01},
	{0x3556, 0x01},
	{0x3557, 0x01},
	{0x3558, 0x01},
	{0x3559, 0x00},
	{0x355A, 0x00},
	{0x35BA, 0x0E},
	{0x366A, 0x1B},
	{0x366B, 0x1A},
	{0x366C, 0x19},
	{0x366D, 0x17},
	{0x33A6, 0x01},
	{0x306B, 0x05},
	{0x3A41, 0x08},
	{0x3019, 0x10},

	{0x302E, 0x04},
	{0x302F, 0x00},
	{0x3030, 0x43},
	{0x3031, 0x05},
	{0x3032, 0x08},
	{0x3033, 0x00},
	{0x3041, 0x30},
	{0x3042, 0x08},
	{0x3043, 0x01},
	{0x30E9, 0x00},

	{0x3134, 0x77},
	{0x3135, 0x00},
	{0x3136, 0x67},
	{0x3137, 0x00},
	{0x3138, 0x00},
	{0x3139, 0x00},
	{0x313A, 0x37},
	{0x313B, 0x00},
	{0x313C, 0x57},
	{0x313D, 0x00},
	{0x313E, 0xDF},
	{0x313F, 0x00},
	{0x3140, 0x00},
	{0x3141, 0x00},
	{0x3142, 0x2F},
	{0x3143, 0x00},
	{0x3144, 0x0F},
	{0x3145, 0x00},
	{0x3A85, 0x03},
	{0x3A86, 0x47},
	{0x3A87, 0x00},

	{REG_DLY, 0x10},

	{0x3000, 0x00},

	{0x303E, 0x02},

	{REG_DLY, 0x10},

	{0x30F4, 0x00},
	{0x3018, 0x02},
	{0x300C, 0x0C},
	{0x300D, 0x00},

	{0x300A, 0xA5},
	{0x300B, 0x07},
	{0x3012, 0x03},

};

static struct regval_list sensor_1080p60_regs[] = {

	{0x3000, 0x12},

	{0x303E, 0x02},
	{0x3120, 0xF0},
	{0x3121, 0x00},
	{0x3122, 0x02},
	{0x3123, 0x01},
	{0x3129, 0x9C},
	{0x312A, 0x02},
	{0x312D, 0x02},
	{0x3AC4, 0x01},
	{0x310B, 0x00},
	{0x30EE, 0x01},
	{0x3304, 0x32},
	{0x3305, 0x00},
	{0x3306, 0x32},
	{0x3307, 0x00},
	{0x3590, 0x32},
	{0x3591, 0x00},
	{0x3686, 0x32},
	{0x3687, 0x00},
	{0x3045, 0x32},
	{0x301A, 0x00},
	{0x304C, 0x00},
	{0x304D, 0x03},
	{0x331C, 0x1A},
	{0x331D, 0x00},
	{0x3502, 0x02},
	{0x3529, 0x0E},
	{0x352A, 0x0E},
	{0x352B, 0x0E},
	{0x3538, 0x0E},
	{0x3539, 0x0E},
	{0x3553, 0x00},
	{0x357D, 0x05},
	{0x357F, 0x05},
	{0x3581, 0x04},
	{0x3583, 0x76},
	{0x3587, 0x01},
	{0x35BB, 0x0E},
	{0x35BC, 0x0E},
	{0x35BD, 0x0E},
	{0x35BE, 0x0E},
	{0x35BF, 0x0E},
	{0x366E, 0x00},
	{0x366F, 0x00},
	{0x3670, 0x00},
	{0x3671, 0x00},
	{0x3004, 0x02},
	{0x3005, 0x21},
	{0x3006, 0x00},
	{0x3007, 0x11},
	{0x300E, 0x00},
	{0x300F, 0x00},
	{0x3037, 0x00},
	{0x3038, 0x00},
	{0x3039, 0x00},
	{0x303A, 0x00},
	{0x303B, 0x00},
	{0x30DD, 0x00},
	{0x30DE, 0x00},
	{0x30DF, 0x00},
	{0x30E0, 0x00},
	{0x30E1, 0x00},
	{0x30E2, 0x02},
	{0x30F6, 0x1E},
	{0x30F7, 0x01},
	{0x30F8, 0x68},
	{0x30F9, 0x10},
	{0x30FA, 0x00},
	{0x3130, 0x4E},
	{0x3131, 0x04},
	{0x3132, 0x46},
	{0x3133, 0x04},
	{0x3A54, 0x8C},
	{0x3A55, 0x07},
	{0x3342, 0x0A},
	{0x3343, 0x00},
	{0x3344, 0x1A},
	{0x3345, 0x00},
	{0x3528, 0x0E},
	{0x3554, 0x00},
	{0x3555, 0x01},
	{0x3556, 0x01},
	{0x3557, 0x01},
	{0x3558, 0x01},
	{0x3559, 0x00},
	{0x355A, 0x00},
	{0x35BA, 0x0E},
	{0x366A, 0x1B},
	{0x366B, 0x1A},
	{0x366C, 0x19},
	{0x366D, 0x17},
	{0x33A6, 0x01},
	{0x306B, 0x05},
	{0x3A41, 0x08},
	{0x3019, 0x10},

	{0x302E, 0x04},
	{0x302F, 0x00},
	{0x3030, 0x43},
	{0x3031, 0x05},
	{0x3032, 0x08},
	{0x3033, 0x00},
	{0x3041, 0x30},
	{0x3042, 0x08},
	{0x3043, 0x01},
	{0x30E9, 0x00},

	{0x3134, 0x77},
	{0x3135, 0x00},
	{0x3136, 0x67},
	{0x3137, 0x00},
	{0x3138, 0x00},
	{0x3139, 0x00},
	{0x313A, 0x37},
	{0x313B, 0x00},
	{0x313C, 0x57},
	{0x313D, 0x00},
	{0x313E, 0xDF},
	{0x313F, 0x00},
	{0x3140, 0x00},
	{0x3141, 0x00},
	{0x3142, 0x2F},
	{0x3143, 0x00},
	{0x3144, 0x0F},
	{0x3145, 0x00},
	{0x3A85, 0x03},
	{0x3A86, 0x47},
	{0x3A87, 0x00},

	{REG_DLY, 0x10},

	{0x3000, 0x00},

	{0x303E, 0x02},

	{REG_DLY, 0x10},

	{0x30F4, 0x00},
	{0x3018, 0x02},
	{0x300C, 0x0C},
	{0x300D, 0x00},

	{0x300A, 0xA5},
	{0x300B, 0x07},
	{0x3012, 0x03},
};
#endif

static struct regval_list sensor_1080p30_regs[] = {
	{0x3000, 0x12},

	{0x303E, 0x02},
	{0x3120, 0xF0},
	{0x3121, 0x00},
	{0x3122, 0x02},
	{0x3123, 0x01},
	{0x3129, 0x9C},
	{0x312A, 0x02},
	{0x312D, 0x02},
	{0x3AC4, 0x01},
	{0x310B, 0x00},
	{0x30EE, 0x01},
	{0x3304, 0x32},
	{0x3305, 0x00},
	{0x3306, 0x32},
	{0x3307, 0x00},
	{0x3590, 0x32},
	{0x3591, 0x00},
	{0x3686, 0x32},
	{0x3687, 0x00},
	{0x3045, 0x32},
	{0x301A, 0x00},
	{0x304C, 0x00},
	{0x304D, 0x03},
	{0x331C, 0x1A},
	{0x331D, 0x00},
	{0x3502, 0x02},
	{0x3529, 0x0E},
	{0x352A, 0x0E},
	{0x352B, 0x0E},
	{0x3538, 0x0E},
	{0x3539, 0x0E},
	{0x3553, 0x00},
	{0x357D, 0x05},
	{0x357F, 0x05},
	{0x3581, 0x04},
	{0x3583, 0x76},
	{0x3587, 0x01},
	{0x35BB, 0x0E},
	{0x35BC, 0x0E},
	{0x35BD, 0x0E},
	{0x35BE, 0x0E},
	{0x35BF, 0x0E},
	{0x366E, 0x00},
	{0x366F, 0x00},
	{0x3670, 0x00},
	{0x3671, 0x00},
	{0x3004, 0x02},
	{0x3005, 0x21},
	{0x3006, 0x00},
	{0x3007, 0x11},
	{0x300E, 0x01},
	{0x300F, 0x00},
	{0x3037, 0x00},
	{0x3038, 0x00},
	{0x3039, 0x00},
	{0x303A, 0x00},
	{0x303B, 0x00},
	{0x30DD, 0x00},
	{0x30DE, 0x00},
	{0x30DF, 0x00},
	{0x30E0, 0x00},
	{0x30E1, 0x00},
	{0x30E2, 0x02},
	{0x30F6, 0x1E},
	{0x30F7, 0x01},
	{0x30F8, 0x68},
	{0x30F9, 0x10},
	{0x30FA, 0x00},
	{0x3130, 0x4E},
	{0x3131, 0x04},
	{0x3132, 0x46},
	{0x3133, 0x04},
	{0x3A54, 0x8C},
	{0x3A55, 0x07},
	{0x3342, 0x0A},
	{0x3343, 0x00},
	{0x3344, 0x1A},
	{0x3345, 0x00},
	{0x3528, 0x0E},
	{0x3554, 0x00},
	{0x3555, 0x01},
	{0x3556, 0x01},
	{0x3557, 0x01},
	{0x3558, 0x01},
	{0x3559, 0x00},
	{0x355A, 0x00},
	{0x35BA, 0x0E},
	{0x366A, 0x1B},
	{0x366B, 0x1A},
	{0x366C, 0x19},
	{0x366D, 0x17},
	{0x33A6, 0x01},
	{0x306B, 0x05},
	{0x3A41, 0x08},
	{0x3019, 0x10},

	{0x302E, 0x04},
	{0x302F, 0x00},
	{0x3030, 0x43},
	{0x3031, 0x05},
	{0x3032, 0x08},
	{0x3033, 0x00},
	{0x3041, 0x30},
	{0x3042, 0x08},
	{0x3043, 0x01},
	{0x30E9, 0x00},

	{0x3134, 0x77},
	{0x3135, 0x00},
	{0x3136, 0x67},
	{0x3137, 0x00},
	{0x3138, 0x00},
	{0x3139, 0x00},
	{0x313A, 0x37},
	{0x313B, 0x00},
	{0x313C, 0x57},
	{0x313D, 0x00},
	{0x313E, 0xDF},
	{0x313F, 0x00},
	{0x3140, 0x00},
	{0x3141, 0x00},
	{0x3142, 0x2F},
	{0x3143, 0x00},
	{0x3144, 0x0F},
	{0x3145, 0x00},
	{0x3A85, 0x03},
	{0x3A86, 0x47},
	{0x3A87, 0x00},

	{REG_DLY, 0x10},

	{0x3000, 0x00},

	{0x303E, 0x02},

	{REG_DLY, 0x10},

	{0x30F4, 0x00},
	{0x3018, 0x02},
	{0x300C, 0x0C},
	{0x300D, 0x00},

	{0x300A, 0xA5},
	{0x300B, 0x07},
	{0x3012, 0x03},
};
#if 0
static struct regval_list sensor_1080p120_regs[] = {
	{0x3000, 0x12},

	{0x303e, 0x02},
	{0x3120, 0xF0},
	{0x3121, 0x00},
	{0x3122, 0x02},
	{0x3123, 0x01},
	{0x3129, 0x9C},
	{0x312A, 0x02},
	{0x312D, 0x02},
	{0x3AC4, 0x01},
	{0x310B, 0x00},
	{0x30EE, 0x01},
	{0x3304, 0x32},
	{0x3305, 0x00},
	{0x3306, 0x32},
	{0x3307, 0x00},
	{0x3590, 0x32},
	{0x3591, 0x00},
	{0x3686, 0x32},
	{0x3687, 0x00},
	{0x3045, 0x32},
	{0x301A, 0x00},
	{0x304C, 0x00},
	{0x304D, 0x03},
	{0x331C, 0x1A},
	{0x331D, 0x00},
	{0x3502, 0x02},
	{0x3529, 0x0E},
	{0x352A, 0x0E},
	{0x352B, 0x0E},
	{0x3538, 0x0E},
	{0x3539, 0x0E},
	{0x3553, 0x00},
	{0x357D, 0x05},
	{0x357F, 0x05},
	{0x3581, 0x04},
	{0x3583, 0x76},
	{0x3587, 0x01},
	{0x35BB, 0x0E},
	{0x35BC, 0x0E},
	{0x35BD, 0x0E},
	{0x35BE, 0x0E},
	{0x35BF, 0x0E},
	{0x366E, 0x00},
	{0x366F, 0x00},
	{0x3670, 0x00},
	{0x3671, 0x00},
	{0x3004, 0x02},
	{0x3005, 0x21},
	{0x3006, 0x00},
	{0x3007, 0x11},
	{0x300E, 0x00},
	{0x300F, 0x00},
	{0x3037, 0x00},
	{0x3038, 0x00},
	{0x3039, 0x00},
	{0x303A, 0x00},
	{0x303B, 0x00},
	{0x30DD, 0x00},
	{0x30DE, 0x00},
	{0x30DF, 0x00},
	{0x30E0, 0x00},
	{0x30E1, 0x00},
	{0x30E2, 0x02},
	{0x30F6, 0x08},
	{0x30F7, 0x01},
	{0x30F8, 0xe0},
	{0x30F9, 0x08},
	{0x30FA, 0x00},
	{0x3130, 0x4E},
	{0x3131, 0x04},
	{0x3132, 0x46},
	{0x3133, 0x04},
	{0x3A54, 0x8C},
	{0x3A55, 0x07},
	{0x3342, 0x0A},
	{0x3343, 0x00},
	{0x3344, 0x1A},
	{0x3345, 0x00},
	{0x3528, 0x0E},
	{0x3554, 0x00},
	{0x3555, 0x01},
	{0x3556, 0x01},
	{0x3557, 0x01},
	{0x3558, 0x01},
	{0x3559, 0x00},
	{0x355A, 0x00},
	{0x35BA, 0x0E},
	{0x366A, 0x1B},
	{0x366B, 0x1A},
	{0x366C, 0x19},
	{0x366D, 0x17},
	{0x33A6, 0x01},
	{0x306B, 0x05},
	{0x3A41, 0x08},
	{0x3019, 0x10},

	{0x302E, 0x04},
	{0x302F, 0x00},
	{0x3030, 0x43},
	{0x3031, 0x05},
	{0x3032, 0x08},
	{0x3033, 0x00},
	{0x3041, 0x30},
	{0x3042, 0x08},
	{0x3043, 0x01},
	{0x30E9, 0x00},

	{0x3134, 0x77},
	{0x3135, 0x00},
	{0x3136, 0x67},
	{0x3137, 0x00},
	{0x3138, 0x00},
	{0x3139, 0x00},
	{0x313A, 0x37},
	{0x313B, 0x00},
	{0x313C, 0x37},
	{0x313D, 0x00},
	{0x313E, 0xdf},
	{0x313F, 0x00},
	{0x3140, 0x00},
	{0x3141, 0x00},
	{0x3142, 0x2f},
	{0x3143, 0x00},
	{0x3144, 0x0F},
	{0x3145, 0x00},
	{0x3A85, 0x03},
	{0x3A86, 0x47},
	{0x3A87, 0x00},

	{REG_DLY, 0x10},

	{0x3000, 0x00},
	{0x303E, 0x02},

	{REG_DLY, 0x10},

	{0x30F4, 0x00},
	{0x3018, 0x02},
	{0x300C, 0x0C},
	{0x300D, 0x00},
};


static struct regval_list sensor_720p180_regs[] = {

	{0x3000, 0x12},

	{0x3120, 0xF0},
	{0x3121, 0x00},
	{0x3122, 0x02},
	{0x3123, 0x01},
	{0x3129, 0x9C},
	{0x312A, 0x02},
	{0x312D, 0x02},
	{0x3AC4, 0x01},
	{0x310B, 0x00},
	{0x30EE, 0x01},
	{0x3304, 0x32},
	{0x3305, 0x00},
	{0x3306, 0x32},
	{0x3307, 0x00},
	{0x3590, 0x32},
	{0x3591, 0x00},
	{0x3686, 0x32},
	{0x3687, 0x00},
	{0x3045, 0x32},
	{0x301A, 0x00},
	{0x304C, 0x00},
	{0x304D, 0x03},
	{0x331C, 0x1A},
	{0x331D, 0x00},
	{0x3502, 0x02},
	{0x3529, 0x0E},
	{0x352A, 0x0E},
	{0x352B, 0x0E},
	{0x3538, 0x0E},
	{0x3539, 0x0E},
	{0x3553, 0x00},
	{0x357D, 0x05},
	{0x357F, 0x05},
	{0x3581, 0x04},
	{0x3583, 0x76},
	{0x3587, 0x01},
	{0x35BB, 0x0E},
	{0x35BC, 0x0E},
	{0x35BD, 0x0E},
	{0x35BE, 0x0E},
	{0x35BF, 0x0E},
	{0x366E, 0x00},
	{0x366F, 0x00},
	{0x3670, 0x00},
	{0x3671, 0x00},
	{0x3004, 0x03},
	{0x3005, 0x31},
	{0x3006, 0x00},
	{0x3007, 0x09},
	{0x300E, 0x00},
	{0x300F, 0x00},
	{0x3037, 0x00},
	{0x3038, 0x00},
	{0x3039, 0x00},
	{0x303A, 0x00},
	{0x303B, 0x00},
	{0x30DD, 0x00},
	{0x30DE, 0x00},
	{0x30DF, 0x00},
	{0x30E0, 0x00},
	{0x30E1, 0x00},
	{0x30E2, 0x03},
	{0x30F6, 0x04},
	{0x30F7, 0x01},
	{0x30F8, 0x02},
	{0x30F9, 0x06},
	{0x30FA, 0x00},
	{0x3130, 0xE2},
	{0x3131, 0x02},
	{0x3132, 0xDE},
	{0x3133, 0x02},
	{0x3A54, 0x08},
	{0x3A55, 0x05},
	{0x3342, 0x0A},
	{0x3343, 0x00},
	{0x3344, 0x1B},
	{0x3345, 0x00},
	{0x3528, 0x0E},
	{0x3554, 0x00},
	{0x3555, 0x01},
	{0x3556, 0x01},
	{0x3557, 0x01},
	{0x3558, 0x01},
	{0x3559, 0x00},
	{0x355A, 0x00},
	{0x35BA, 0x0E},
	{0x366A, 0x1B},
	{0x366B, 0x19},
	{0x366C, 0x17},
	{0x366D, 0x17},
	{0x33A6, 0x01},
	{0x306B, 0x05},
	{0x3A41, 0x04},
	{0x3019, 0x10},

	{0x302E, 0x04},
	{0x302F, 0x00},
	{0x3030, 0x43},
	{0x3031, 0x05},
	{0x3032, 0x08},
	{0x3033, 0x00},
	{0x3041, 0x30},
	{0x3042, 0x08},
	{0x3043, 0x01},
	{0x30E9, 0x00},

	{0x3134, 0x77},
	{0x3135, 0x00},
	{0x3136, 0x67},
	{0x3137, 0x00},
	{0x3138, 0x00},
	{0x3139, 0x00},
	{0x313A, 0x37},
	{0x313B, 0x00},
	{0x313C, 0x37},
	{0x313D, 0x00},
	{0x313E, 0xDF},
	{0x313F, 0x00},
	{0x3140, 0x00},
	{0x3141, 0x00},
	{0x3142, 0x2F},
	{0x3143, 0x00},
	{0x3144, 0x0F},
	{0x3145, 0x00},
	{0x3A85, 0x03},
	{0x3A86, 0x47},
	{0x3A87, 0x00},

	{REG_DLY, 0x10},

	{0x3000, 0x00},
	{0x303E, 0x02},

	{REG_DLY, 0x07},

	{0x30F4, 0x00},
	{0x3018, 0x02},
	{0x300C, 0x0C},
	{0x300D, 0x00},
};

static struct regval_list sensor_540p240_regs[] = {
	{0x3000, 0x12},

	{0x3120, 0xF0},
	{0x3121, 0x00},
	{0x3122, 0x02},
	{0x3123, 0x01},
	{0x3129, 0x9C},
	{0x312A, 0x02},
	{0x312D, 0x02},
	{0x3AC4, 0x01},
	{0x310B, 0x00},
	{0x30EE, 0x01},
	{0x3304, 0x32},
	{0x3305, 0x00},
	{0x3306, 0x32},
	{0x3307, 0x00},
	{0x3590, 0x32},
	{0x3591, 0x00},
	{0x3686, 0x32},
	{0x3687, 0x00},
	{0x3045, 0x32},
	{0x301A, 0x00},
	{0x304C, 0x00},
	{0x304D, 0x03},
	{0x331C, 0x1A},
	{0x331D, 0x00},
	{0x3502, 0x02},
	{0x3529, 0x0E},
	{0x352A, 0x0E},
	{0x352B, 0x0E},
	{0x3538, 0x0E},
	{0x3539, 0x0E},
	{0x3553, 0x00},
	{0x357D, 0x05},
	{0x357F, 0x05},
	{0x3581, 0x04},
	{0x3583, 0x76},
	{0x3587, 0x01},
	{0x35BB, 0x0E},
	{0x35BC, 0x0E},
	{0x35BD, 0x0E},
	{0x35BE, 0x0E},
	{0x35BF, 0x0E},
	{0x366E, 0x00},
	{0x366F, 0x00},
	{0x3670, 0x00},
	{0x3671, 0x00},
	{0x3004, 0x04},
	{0x3005, 0x31},
	{0x3006, 0x00},
	{0x3007, 0x02},
	{0x300E, 0x00},
	{0x300F, 0x00},
	{0x3037, 0x00},
	{0x3038, 0x00},
	{0x3039, 0x00},
	{0x303A, 0x00},
	{0x303B, 0x00},
	{0x30DD, 0x00},
	{0x30DE, 0x00},
	{0x30DF, 0x00},
	{0x30E0, 0x00},
	{0x30E1, 0x00},
	{0x30E2, 0x04},
	{0x30F6, 0x04},
	{0x30F7, 0x01},
	{0x30F8, 0x83},
	{0x30F9, 0x04},
	{0x30FA, 0x00},
	{0x3130, 0x26},
	{0x3131, 0x02},
	{0x3132, 0x22},
	{0x3133, 0x02},
	{0x3A54, 0x08},
	{0x3A55, 0x05},
	{0x3342, 0x0A},
	{0x3343, 0x00},
	{0x3344, 0x1A},
	{0x3345, 0x00},
	{0x3528, 0x0E},
	{0x3554, 0x00},
	{0x3555, 0x01},
	{0x3556, 0x01},
	{0x3557, 0x01},
	{0x3558, 0x01},
	{0x3559, 0x00},
	{0x355A, 0x00},
	{0x35BA, 0x0E},
	{0x366A, 0x1B},
	{0x366B, 0x19},
	{0x366C, 0x17},
	{0x366D, 0x17},
	{0x33A6, 0x01},
	{0x306B, 0x05},
	{0x3A41, 0x04},
	{0x3019, 0x10},

	{0x302E, 0x04},
	{0x302F, 0x00},
	{0x3030, 0x43},
	{0x3031, 0x05},
	{0x3032, 0x08},
	{0x3033, 0x00},
	{0x3041, 0x30},
	{0x3042, 0x08},
	{0x3043, 0x01},
	{0x30E9, 0x00},

	{0x3134, 0x77},
	{0x3135, 0x00},
	{0x3136, 0x67},
	{0x3137, 0x00},
	{0x3138, 0x00},
	{0x3139, 0x00},
	{0x313A, 0x37},
	{0x313B, 0x00},
	{0x313C, 0x37},
	{0x313D, 0x00},
	{0x313E, 0xDF},
	{0x313F, 0x00},
	{0x3140, 0x00},
	{0x3141, 0x00},
	{0x3142, 0x2F},
	{0x3143, 0x00},
	{0x3144, 0x0F},
	{0x3145, 0x00},
	{0x3A85, 0x03},
	{0x3A86, 0x47},
	{0x3A87, 0x00},

	{REG_DLY, 0x10},

	{0x3000, 0x00},
	{0x303E, 0x02},

	{REG_DLY, 0x07},

	{0x30F4, 0x00},
	{0x3018, 0x02},
	{0x300C, 0x0C},
	{0x300D, 0x00},
};

static struct regval_list sensor_1080p30wdr_regs[] = {
	{0x3000, 0x12},

	{0x3120, 0xF0},
	{0x3121, 0x00},
	{0x3122, 0x02},
	{0x3123, 0x01},
	{0x3129, 0x9C},
	{0x312A, 0x02},
	{0x312D, 0x02},
	{0x3AC4, 0x01},
	{0x310B, 0x00},

	{0x304C, 0x00},
	{0x304D, 0x03},

	{0x331C, 0x1A},
	{0x331D, 0x00},
	{0x3502, 0x02},
	{0x3529, 0x0E},
	{0x352A, 0x0E},
	{0x352B, 0x0E},
	{0x3538, 0x0E},
	{0x3539, 0x0E},
	{0x3553, 0x00},
	{0x357D, 0x05},

	{0x357F, 0x05},

	{0x3581, 0x04},

	{0x3583, 0x76},
	{0x3587, 0x01},
	{0x35BB, 0x0E},
	{0x35BC, 0x0E},
	{0x35BD, 0x0E},
	{0x35BE, 0x0E},
	{0x35BF, 0x0E},
	{0x366E, 0x00},

	{0x366F, 0x00},

	{0x3670, 0x00},

	{0x3671, 0x00},

	{0x30EE, 0x01},
	{0x3304, 0x32},
	{0x3305, 0x00},
	{0x3306, 0x32},
	{0x3307, 0x00},
	{0x3590, 0x32},
	{0x3591, 0x00},
	{0x3686, 0x32},
	{0x3687, 0x00},
	{0x3134, 0x77},
	{0x3135, 0x00},
	{0x3136, 0x67},
	{0x3137, 0x00},
	{0x3138, 0x00},
	{0x3139, 0x00},
	{0x313A, 0x37},
	{0x313B, 0x00},
	{0x313C, 0x37},
	{0x313D, 0x00},
	{0x313E, 0xDF},
	{0x313F, 0x00},
	{0x3140, 0x00},
	{0x3141, 0x00},
	{0x3142, 0x2F},
	{0x3143, 0x00},
	{0x3144, 0x0F},
	{0x3145, 0x00},
	{0x3A86, 0x47},
	{0x3A87, 0x00},
	{0x3004, 0x07},
	{0x3005, 0x21},
	{0x3006, 0x00},
	{0x3007, 0x11},
	{0x3019, 0x11},

	{0x301A, 0x0 },

	{0x302E, 0x04},
	{0x302F, 0x00},
	{0x3030, 0x0A},
	{0x3031, 0x00},
	{0x3032, DOL_RHS1&0xff},
	{0x3033, DOL_RHS1>>8},
	{0x3041, 0x31},
	{0x3042, 0x90},
	{0x3043, 0x1 },

	{0x306B, 0x05},
	{0x30E2, 0x02},
	{0x30E9, 0x01},
	{0x30EE, 0x1 },
	{0x30F6, 0x40},
	{0x30F7, 0x6 },
	{0x30F8, 0xDC},
	{0x30F9, 0x5 },
	{0x30FA, 0x0 },

	{0x3130, V_SIZE&0xff},
	{0x3131, V_SIZE>>8},

	{0x3132, OUT_SIZE&0xff},
	{0x3133, V_SIZE>>8},

	{0x3342, 0x0A},
	{0x3343, 0x00},
	{0x3344, 0x1A},
	{0x3345, 0x00},
	{0x33A6, 0x01},
	{0x3528, 0x0E},
	{0x3554, 0x00},
	{0x3555, 0x01},
	{0x3556, 0x01},
	{0x3557, 0x01},
	{0x3558, 0x01},
	{0x3559, 0x00},
	{0x355A, 0x00},
	{0x35BA, 0x0E},
	{0x366A, 0x1B},
	{0x366B, 0x1A},
	{0x366C, 0x19},
	{0x366D, 0x17},
	{0x3A41, 0x08},

	{0x3000, 0x00},
	{0x303E, 0x02},
	{0x30F4, 0x00},
	{0x3018, 0xA2},
};

/*
 * Here we'll try to encapsulate the changes for just the output
 * video format.
 *
 */
static struct regval_list sensor_fmt_raw[] = {

};
#endif

static int imx317_sensor_vts;
static int imx317_sensor_svr;
static int shutter_delay = 1;
static int shutter_delay_cnt;
static int fps_change_flag;

static int sensor_s_exp(unsigned int exp_val)
{
	data_type explow, exphigh;
	int shutter;

	shutter = imx317_sensor_vts - ((exp_val + 8) >> 4);

	if (shutter > imx317_sensor_vts - 4)
		shutter = imx317_sensor_vts - 4;
	if (shutter < 12)
		shutter = 12;

	exphigh = (unsigned char) ((0xff00 & shutter) >> 8);
	explow = (unsigned char) ((0x00ff & shutter));

	sensor_write(0x300c, explow);
	sensor_write(0x300d, exphigh);
	sensor_dbg("sensor_set_exp = %d line Done!\n", exp_val);

	return 0;
}

static int sensor_s_gain(int gain_val)
{
	data_type gainlow = 0;
	data_type gainhigh = 0;
	data_type gaindig = 0;
	int gainana = gain_val;

	if (gainana < 22*16) {
		gaindig = 0;
	} else if (gainana < 22*32) {
		gainana /= 2;
		gaindig = 1;
	} else if (gainana < 22*64) {
		gainana /= 4;
		gaindig = 2;
	} else if (gainana < 22*128) {
		gainana /= 8;
		gaindig = 3;
	} else if (gainana < 22*256) {
		gainana /= 16;
		gaindig = 4;
	} else if (gainana < 22*512) {
		gainana /= 32;
		gaindig = 5;
	} else {
		gainana /= 64;
		gaindig = 6;
	}

	gainana = 2048 - 32768 / gainana;
	gainlow = (unsigned char)(gainana & 0xff);
	gainhigh = (unsigned char)((gainana>>8) & 0x07);

	sensor_write(0x300a, gainlow);
	sensor_write(0x300b, gainhigh);
	sensor_write(0x3012, gaindig);

	sensor_dbg("sensor_set_gain = %d, Done!\n", gain_val);

	return 0;
}

int sensor_s_exp_gain(struct sensor_exp_gain *exp_gain)
{
	int exp_val, gain_val;

	exp_val = exp_gain->exp_val;
	gain_val = exp_gain->gain_val;

	if (gain_val < 1 * 16)
		gain_val = 16;
	if (exp_val > 0xfffff)
		exp_val = 0xfffff;
	if (fps_change_flag) {
		if (shutter_delay_cnt == shutter_delay) {
			sensor_write(0x30f8, imx317_sensor_vts / (imx317_sensor_svr + 1) & 0xFF);
			sensor_write(0x30f9, imx317_sensor_vts / (imx317_sensor_svr + 1) >> 8 & 0xFF);
			sensor_write(0x30fa, imx317_sensor_vts / (imx317_sensor_svr + 1) >> 16);
			sensor_write(0x302d, 0);
			shutter_delay_cnt = 0;
			fps_change_flag = 0;
		} else
			shutter_delay_cnt++;
	}

	sensor_s_exp(exp_val);
	sensor_s_gain(gain_val);

	sensor_dbg("sensor_set_gain exp = %d, %d Done!\n", gain_val, exp_val);
	return 0;
}



struct sensor_format_struct sensor_formats[] = {
	{
		.desc = "Raw RGB Bayer",
		.mbus_code = MEDIA_BUS_FMT_SRGGB10_1X10,
		.width = 1920,
		.height = 1080,
		.o_width = 640,
		.o_height = 480,
		.offs_h = 0,
		.offs_v = 0,
		.fourcc = V4L2_PIX_FMT_NV12,
		.field = V4L2_FIELD_NONE,
	},
};

int sensor_g_mbus_config(struct v4l2_mbus_config *cfg, struct mbus_framefmt_res *res)
{
	cfg->type = V4L2_MBUS_CSI2;
	cfg->flags = 0 | V4L2_MBUS_CSI2_4_LANE | V4L2_MBUS_CSI2_CHANNEL_0;

	res->res_combo_mode = CMB_TERMINAL_RES | CMB_PHYA_OFFSET3 | MIPI_NORMAL_MODE;

	return 0;
}

/*
 * Stuff that knows about the sensor.
 */
int sensor_power(int on)
{
	switch (on) {
	case PWR_ON:
		sensor_dbg("PWR_ON!\n");
		vin_gpio_set_status(1);
		vin_gpio_write(CSI_GPIO_LOW);
		udelay(2000);
		vin_set_pmu_channel(1);
		udelay(2000);
		vin_gpio_write(CSI_GPIO_HIGH);
		vin_set_mclk(1);
		vin_set_mclk_freq(MCLK);
		udelay(2000);
		break;
	case PWR_OFF:
		sensor_dbg("PWR_OFF!\n");
		vin_set_mclk(0);
		vin_gpio_write(CSI_GPIO_LOW);
		vin_gpio_set_status(0);
		udelay(2000);
		vin_set_pmu_channel(0);
		udelay(2000);
		break;
	default:
		return -EINVAL;
	}

	return 0;
}

static int sensor_detect(void)
{
	data_type rdval = 0;
	int ret;

	ret = sensor_read(0x3008, &rdval);
	if (ret)
		return 1;
	sensor_dbg("%s read value is 0x%x\n", __func__, rdval);
	sensor_read(0x3004, &rdval);
	sensor_dbg("%s read value is 0x%x\n", __func__, rdval);
	sensor_read(0x3005, &rdval);
	sensor_print("%s read value is 0x%x\n", __func__, rdval);
	return 0;
}

int sensor_init(void)
{
	int ret;

	sensor_dbg("sensor_init\n");

	/*Make sure it is a target sensor */
	ret = sensor_detect();
	if (ret) {
		sensor_err("chip found is not an target chip.\n");
		return ret;
	}

	return 0;
}
static int sensor_reg_init(void)
{
	int ret;
	struct sensor_exp_gain exp_gain;

	ret = sensor_write_array(sensor_default_regs,
				 ARRAY_SIZE(sensor_default_regs));
	if (ret < 0) {
		sensor_err("write sensor_default_regs error\n");
		return ret;
	}

	sensor_dbg("sensor_reg_init\n");

	sensor_write_array(sensor_1080p30_regs, ARRAY_SIZE(sensor_1080p30_regs));

	exp_gain.exp_val = 65456;
	exp_gain.gain_val = 70;
	sensor_s_exp_gain(&exp_gain);

	sensor_dbg("s_fmt set width = %d, height = %d\n", 1920, 1080);

	return 0;
}

int sensor_s_stream(int enable)
{
	if (!enable)
		return 0;

	return sensor_reg_init();
}

int sensor_test_i2c(void)
{
	int ret;
	sensor_power(PWR_ON);
	ret = sensor_init();
	sensor_power(PWR_OFF);

	return ret;
}

